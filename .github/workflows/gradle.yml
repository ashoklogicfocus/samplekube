name: User Approval Workflow

on:
  push:
    branches:
      - master

jobs:
  stage-1-echo:
    runs-on: ubuntu-latest
    steps:
      - name: Echo Stage 1
        run: echo "Stage 1"

  stage-2-echo:
    needs: stage-1-echo
    runs-on: ubuntu-latest
    steps:
      - name: Echo Stage 2
        run: echo "Stage 2"

  create-user:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    steps:
      - name: Create User
        run: echo "User created"
      - name: Request Approval
        uses: actions/github-script@v4
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.repos.createStatus({
              owner: context.repo.owner,
              repo: context.repo.repo,
              sha: github.sha,
              state: 'pending',
              context: 'manual-approval',
              description: 'Waiting for approval',
              target_url: 'https://example.com'
            })

